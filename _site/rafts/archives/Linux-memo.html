<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <link rel="icon" type="image/x-icon" href="/favicon.ico">
  <link rel="apple-touch-icon" href="/apple-touch-icon.png">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.6.1 -->
<title>Linux memo | Not a Blog</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="Linux memo" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Just memo, not a blog." />
<meta property="og:description" content="Just memo, not a blog." />
<link rel="canonical" href="http://localhost:4000/archives/Linux-memo.html" />
<meta property="og:url" content="http://localhost:4000/archives/Linux-memo.html" />
<meta property="og:site_name" content="Not a Blog" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2019-09-09T00:00:00+08:00" />
<script type="application/ld+json">
{"headline":"Linux memo","dateModified":"2019-09-09T00:00:00+08:00","datePublished":"2019-09-09T00:00:00+08:00","url":"http://localhost:4000/archives/Linux-memo.html","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/archives/Linux-memo.html"},"description":"Just memo, not a blog.","@type":"BlogPosting","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link href="https://fonts.googleapis.com/css?family=Domine|Asap|Noto+Sans+SC|Noto+Serif+SC&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/assets/main.css"><link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="Not a Blog" /></head><body><script type="text/javascript" async src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-MML-AM_CHTML">
</script>

<header class="site-header" role="banner">

  <div class="wrapper"><!-- <a class="site-title" rel="author" href="/">Not a Blog</a> -->
    <!-- <a class="site-title" rel="author" href="/"> $$\mathbb{\text{Not A BB of R2FsCg}}$$ </a> -->
    <a class="site-title" rel="author" href="/" style="font-family: 'Times New Roman'"> Not a Blog of <span style="color: gray;">@R2FsCg</span> </a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/links/">Links</a><a class="page-link" href="/tags/">Tags</a><a class="page-link" href="/categories/">Categories</a><a class="page-link" href="/about/">About</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <script type="text/javascript" async src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-MML-AM_CHTML">
</script>

<article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Linux memo</h1>
    <p class="post-meta"><time class="dt-published" datetime="2019-09-09T00:00:00+08:00" itemprop="datePublished">Published: Sep 9, 2019</time></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <p>Just memo, not a blog.</p>

<h2 id="文件传输">文件传输</h2>
<h3 id="wget">wget</h3>
<p><code class="highlighter-rouge">wget</code> :</p>
<ul>
  <li><code class="highlighter-rouge">-b</code>, background 后台执行， <code class="highlighter-rouge">-c</code> 断点续传</li>
  <li><code class="highlighter-rouge">-q</code>, quiet mode</li>
  <li><code class="highlighter-rouge">-i filenames.txt</code>，下载<code class="highlighter-rouge">filenames.txt</code>中多个文件</li>
  <li><code class="highlighter-rouge">wget -r -np -nd http://example.com/packages/</code>， <code class="highlighter-rouge">-np --no-parent</code> 不遍历父目录，<code class="highlighter-rouge">-nd</code> 不在本机重新创建目录结构</li>
  <li><code class="highlighter-rouge">--restrict-file-names=nocontrol</code>避免中文乱码</li>
</ul>

<h3 id="youtube-dl">youtube-dl</h3>
<ul>
  <li><code class="highlighter-rouge">youtube-dl -f best url</code>, 自动下载音视频质量最好的格式</li>
  <li><code class="highlighter-rouge">youtube-dl -f 'bestvideo[ext=mp4]+bestaudio[ext=m4a]/bestvideo+bestaudio' --merge-output-format mp4 url</code>,如果以上命令出错，可以考虑使用这条</li>
</ul>

<h2 id="内容查看与编辑">内容查看与编辑</h2>
<h3 id="tree">tree</h3>
<ul>
  <li><code class="highlighter-rouge">-L 2</code>, 深度设为2</li>
</ul>

<h3 id="tr--translate-characters">tr – translate characters</h3>
<p>语法</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>usage: <span class="nb">tr</span> <span class="o">[</span><span class="nt">-Ccsu</span><span class="o">]</span> string1 string2
       <span class="nb">tr</span> <span class="o">[</span><span class="nt">-Ccu</span><span class="o">]</span> <span class="nt">-d</span> string1
       <span class="nb">tr</span> <span class="o">[</span><span class="nt">-Ccu</span><span class="o">]</span> <span class="nt">-s</span> string1
       <span class="nb">tr</span> <span class="o">[</span><span class="nt">-Ccu</span><span class="o">]</span> <span class="nt">-ds</span> string1 string2
</code></pre></div></div>
<p>E.g., Translate to text to uppercase</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cat </span>somefile.txt | <span class="nb">tr</span> <span class="o">[</span>:lower:] <span class="o">[</span>:upper:] <span class="c"># or, simply</span>
<span class="nb">cat </span>somefile.txt | <span class="nb">tr </span>a-z A-Z
<span class="c"># Translate white-space to tabs</span>
<span class="nb">echo</span> <span class="s2">"How are you?"</span> | <span class="nb">tr</span> <span class="o">[</span>:space:] <span class="s1">'\t'</span>
<span class="c">#Translate braces into parenthesis</span>
<span class="nb">cat </span>somefile.txt | <span class="nb">tr</span> <span class="s1">'{}'</span> <span class="s1">'()'</span>
<span class="c">#Squeeze repetition of characters using `-s` | 合并重复字符 </span>
<span class="nb">echo</span> <span class="s2">"Oh soooooooo             much space"</span> | <span class="nb">tr</span> <span class="nt">-s</span> <span class="o">[</span>:space:] <span class="s1">' '</span>
<span class="c">#Delete specified characters using -d option (区分大小写)</span>
<span class="nb">echo</span> <span class="s2">"Terrible test"</span> | <span class="nb">tr</span> <span class="nt">-d</span> <span class="s1">'t'</span>
<span class="c">#取反 `-c`，比如只保留数字</span>
<span class="nb">echo</span> <span class="s2">"char char 8742"</span> | <span class="nb">tr</span> <span class="nt">-cd</span> <span class="o">[</span>:digit:]
</code></pre></div></div>

<h3 id="shred">shred</h3>

<p>Safely overwrite and remove files.</p>

<p><code class="highlighter-rouge">shred [options] file</code></p>

<ul>
  <li><code class="highlighter-rouge">-n</code>  overwrite n times, default <code class="highlighter-rouge">n=3</code></li>
  <li><code class="highlighter-rouge">-v</code> verbose</li>
  <li><code class="highlighter-rouge">-z</code> add final overwrite with zeros to hiding shredding</li>
  <li><code class="highlighter-rouge">-u</code> remove file after overwritting</li>
</ul>

<p>Note: <code class="highlighter-rouge">rm t.txt</code> 并没有真正删除文件，只是删除了文件的索引，文件内容还在磁盘上。</p>

<h2 id="树莓派">树莓派</h2>

<h3 id="ssh卡顿">SSH卡顿</h3>
<p>ssh登录后反应很慢，<code class="highlighter-rouge">ls</code>命令都响应半天。重启多次，还是一样结果。
与战略伙伴<a href="www.google.com">Google</a>进行沟通后发现，问题可能在于路由器。于是重启路由器，然后问题解决，简直玄学。</p>

<h2 id="apps">Apps</h2>

<ul>
  <li>Macbook network speed monitor <code class="highlighter-rouge">MenuMetersApp</code></li>
</ul>

<h1 id="haproxy">HAProxy</h1>

<p><code class="highlighter-rouge">HA</code> stands for <code class="highlighter-rouge">High Avaliability</code>.</p>

<p>HAProxy提供高可用性、负载均衡以及基于TCP和HTTP应用的代理，支持虚拟主机，免费、快速并且可靠。据官方数据，其最高极限支持10G的并发。</p>

<p>HAProxy特别适用于那些负载特大的web站点，这些站点通常又需要会话保持或七层处理。HAProxy运行在当前的硬件上，可以支持数以万计的并发连接。并且它的运行模式使得它可以很简单安全的整合到当前的架构中，同时可以保护web服务器不被暴露到网络上。</p>

<p>其支持从4层至7层的网络交换，即覆盖所有的TCP协议。</p>

<h2 id="基本配置及说明">基本配置及说明</h2>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>global               <span class="c">#全局设置</span>
    log 127.0.0.1   local0   <span class="c">#日志输出配置，所有日志都记录在本机，通过local0输出</span>
    <span class="c">#log loghost    local0 info</span>
    maxconn 4096             <span class="c">#最大连接数</span>
    <span class="nb">chroot</span> /usr/local/haproxy
    uid 99                   <span class="c">#所属运行的用户uid</span>
    gid 99                   <span class="c">#所属运行的用户组</span>
    group haproxy            <span class="c">#用户组</span>
    daemon                   <span class="c">#后台运行haproxy</span>
    nbproc 1                 <span class="c">#启动1个haproxy实例</span>
    pidfile /usr/local/haproxy/haproxy.pid  <span class="c">#将所有进程PID写入pid文件</span>
    <span class="c">#debug</span>
    <span class="c">#quiet</span>
 
defaults             <span class="c">#默认设置</span>
    <span class="c">#log    global</span>
    log     127.0.0.1       local3      <span class="c">#日志文件的输出定向</span>
 
    <span class="c">#默认的模式:tcp|http|health</span>
    mode   http         <span class="c">#所处理的类别,默认采用http模式</span>
 
    option  httplog      <span class="c">#日志类别,采用http日志格式`</span>
    option  dontlognull
    option  forwardfor   <span class="c">#将客户端真实ip加到HTTP Header中供后端服务器读取</span>
    option  retries 3    <span class="c">#三次连接失败则认证服务器不可用</span>
    option  httpclose    <span class="c">#每次请求完毕后主动关闭http通道,haproxy不支持keep-alive,只能模拟这种模式的实现</span>
    retries 3            <span class="c">#3次连接失败就认为服务器不可用，主要通过后面的check检查</span>
    option  redispatch   <span class="c">#当serverid对应的服务器挂掉后，强制定向到其他健康服务器</span>
    option  abortonclose <span class="c">#当服务器负载很高时，自动结束掉当前队列中处理比较久的链接</span>
    maxconn 2000         <span class="c">#默认最大连接数</span>
 
    <span class="nb">timeout </span>connect 5000  <span class="c">#连接超时时间</span>
    <span class="nb">timeout </span>client  50000 <span class="c">#客户端连接超时时间</span>
    <span class="nb">timeout </span>server  50000 <span class="c">#服务器端连接超时时间</span>
 
    stats   <span class="nb">enable
    </span>stats   uri /haproxy-stats   <span class="c">#haproxy监控页面的访问地址</span>
    stats   auth <span class="nb">test</span>:test123    <span class="c">#设置监控页面的用户和密码</span>
    stats   hide-version         <span class="c">#隐藏统计页面的HAproxy版本信息</span>
 
frontend http-in              <span class="c">#前台</span>
    <span class="nb">bind</span>    <span class="k">*</span>:81
    mode    http
    option  httplog
    log     global
    default_backend htmpool   <span class="c">#静态服务器池</span>
 
backend htmpool               <span class="c">#后台</span>
		option allbackups  <span class="c">#设置了backup的时候,默认第一个backup会优先,设置option allbackups后所有备份服务器权重一样</span>
    balance leastconn         <span class="c">#负载均衡算法，其他可选 source, roundrobin</span>
    <span class="c"># source 根据客户端IP进行哈希的方式</span>
    <span class="c"># roundrobin 轮转</span>
    <span class="c"># leastcon 选择当前请求数最少的服务器</span>
    option  httpchk HEAD /index.html HTTP/1.0    <span class="c">#健康检查</span>
    server  web1 192.168.2.10:80 cookie 1 weight 5 check inter 2000 rise 2 fall 3
    server  web2 192.168.2.11:80 cookie 2 weight 3 check inter 2000 rise 2 fall 3
    <span class="c"># web1/web2:自定义服务器别名</span>
    <span class="c"># 192.168.2.10:80:服务器IP:Port</span>
    <span class="c"># cookie 1/2:表示serverid</span>
    <span class="c"># weight: 服务器权重，数字越大分配到的请求数越高</span>
    <span class="c"># check: 接受定时健康检查 </span>
    <span class="c"># inter 2000: 检查频率</span>
    <span class="c"># rise 2: 两次检测正确认为服务器可用</span>
    <span class="c"># fall 3: 三次失败认为服务器不可用</span>
 
 		<span class="c">#备份机器配置,正常情况下备机不会使用,当主机的全部服务器都down的时候备机会启用</span>
    server backup1 10.1.7.114:80 check backup inter 1500 rise 3 fall 3
    server bakcup2 10.1.7.114:80 check backup inter 1500 rise 3 fall 3
 
 
listen w.gdu.me 0.0.0.0:80
    option  httpchk GET /index.html
    server  s1 192.168.2.10:80 weight 3 check
    server  s3 192.168.2.11:80 weight 3 check
 
<span class="c"># https的配置方法</span>
<span class="c"># ------------------------------------------------------------------------------------</span>
listen login_https_server
    <span class="nb">bind </span>0.0.0.0:443   <span class="c">#绑定HTTPS的443端口</span>
    mode tcp           <span class="c">#https必须使用tcp模式</span>
    log global
    balance roundrobin
    option httpchk GET /member/login.jhtml HTTP/1.1<span class="se">\r\n</span>Host:login.daily.taobao.net
    <span class="c">#回送给server的端口也必须是443</span>
    server vm94f.sqa 192.168.212.94:443 check port 80 inter 6000 rise 3 fall 3
    server v215120.sqa 192.168.215.120:443 check port 80 inter 6000 rise 3 fall 3
 
 
<span class="c"># frontend配置</span>
<span class="c"># --------------------------------------------------------------------------</span>
frontend http_80_in
    <span class="nb">bind </span>0.0.0.0:80   <span class="c">#监听端口</span>
    mode http         <span class="c">#http的7层模式</span>
    log global        <span class="c">#使用全局的日志配置</span>
    option httplog    <span class="c">#启用http的log</span>
    option httpclose  <span class="c">#每次请求完毕后主动关闭http通道,HA-Proxy不支持keep-alive模式</span>
    option forwardfor <span class="c">##如果后端服务器需要获得客户端的真实IP需要配置次参数,将可以从Http Header中获得客户端IP</span>
 
    <span class="c">#HAProxy的日志记录内容配置</span>
    capture request header Host len 40              <span class="c"># 请求中的主机名</span>
    capture request header Content-Length len 10    <span class="c"># 请求中的内容长度</span>
    capture request header Referer len 200          <span class="c"># 请求中的引用地址</span>
    capture response header Server len 40           <span class="c"># 响应中的server name</span>
    capture response header Content-Length len 10   <span class="c"># 响应中的内容长度(可配合option logasap使用)</span>
    capture response header Cache-Control len 8     <span class="c"># 响应中的cache控制</span>
    capture response header Location len 20         <span class="c"># 响应中的重定向地址</span>
 
 
    <span class="c">#ACL策略规则定义</span>
    <span class="c">#-------------------------------------------------</span>
    <span class="c">#如果请求的域名满足正则表达式返回true(-i:忽略大小写)</span>
    acl denali_policy hdr_reg<span class="o">(</span>host<span class="o">)</span> <span class="nt">-i</span> ^<span class="o">(</span>www.gemini.taobao.net|my.gemini.taobao.net|auction1.gemini.taobao.net<span class="o">)</span><span class="err">$</span>
 
    <span class="c">#如果请求域名满足trade.gemini.taobao.net返回true</span>
    acl tm_policy hdr_dom<span class="o">(</span>host<span class="o">)</span> <span class="nt">-i</span> trade.gemini.taobao.net
 
    <span class="c">#在请求url中包含sip_apiname=,则此控制策略返回true,否则为false</span>
    acl invalid_req url_sub <span class="nt">-i</span> <span class="nv">sip_apiname</span><span class="o">=</span>
 
    <span class="c">#在请求url中存在timetask作为部分地址路径,则此控制策略返回true,否则返回false</span>
    acl timetask_req url_dir <span class="nt">-i</span> timetask
 
    <span class="c">#当请求的header中Content-length等于0时返回true</span>
    acl missing_cl hdr_cnt<span class="o">(</span>Content-length<span class="o">)</span> eq 0
 
 
    <span class="c">#ACL策略匹配相应</span>
    <span class="c">#-------------------------------------------------</span>
    <span class="c">#当请求中header中Content-length等于0阻止请求返回403</span>
    <span class="c">#block表示阻止请求,返回403错误</span>
    block <span class="k">if </span>missing_cl
 
    <span class="c">#如果不满足策略invalid_req,或者满足策略timetask_req,则阻止请求</span>
    block <span class="k">if</span> <span class="o">!</span>invalid_req <span class="o">||</span> timetask_req
 
    <span class="c">#当满足denali_policy的策略时使用denali_server的backend</span>
    use_backend denali_server <span class="k">if </span>denali_policy
 
    <span class="c">#当满足tm_policy的策略时使用tm_server的backend</span>
    use_backend tm_server <span class="k">if </span>tm_policy
 
    <span class="c">#reqisetbe关键字定义,根据定义的关键字选择backend</span>
    reqisetbe ^Host:<span class="se">\ </span>img           dynamic
    reqisetbe ^[^<span class="se">\ </span><span class="o">]</span><span class="k">*</span><span class="se">\ </span>/<span class="o">(</span>img|css<span class="o">)</span>/  dynamic
    reqisetbe ^[^<span class="se">\ </span><span class="o">]</span><span class="k">*</span><span class="se">\ </span>/admin/stats stats
 
    <span class="c">#以上都不满足的时候使用默认mms_server的backend</span>
    default_backend mms_server
 
    <span class="c">#HAProxy错误页面设置</span>
    errorfile 400 /home/admin/haproxy/errorfiles/400.http
    errorfile 403 /home/admin/haproxy/errorfiles/403.http
    errorfile 504 /home/admin/haproxy/errorfiles/504.http
</code></pre></div></div>


  </div>

  <hr>
  <p style="font-family: 'Times New Roman', Times, serif;" align='right'>Sharing is caring  
  <a href="https://twitter.com/intent/tweet?text=Linux memo&url=http://localhost:4000/archives/Linux-memo.html" title="Share on Twitter" rel="nofollow" target="_blank"> <img src="/images/logos/twitterlogo.png" width="50px"> </a>
  <a href="https://facebook.com/sharer/sharer.php?u=http://localhost:4000/archives/Linux-memo.html" title="Share on Facebook" target="_blank"> <img src="/images/logos/facebook-logo2.png" width="50px"> </a>
  <a href="http://service.weibo.com/share/share.php?url=http://localhost:4000/archives/Linux-memo.html&appkey=&title=Linux memo&pic=&ralateUid=&language=zh_cn" title="Share on weibo" rel="nofollow" target="_blank"> <img src="/images/logos/weibo-logo2.jpg" width="50px"> </a>
  </p>

  <p align="right" style="font-family: 'Times New Roman', Times, serif;">Contact me <a href="mailto:deepccccat@aol.com"> 
    <img src="/images/logos/mail-logo.png" width="50px">
    </a></p><a class="u-url" href="/archives/Linux-memo.html" hidden></a>
</article>
      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <!-- <h2 class="footer-heading">Not a Blog</h2> -->
    <!-- <h3 class="footer-heading"> 
      $$\text{A deep learning enthusiast, who believes in the power of AI} $$
      $$\text{ and the ethics of humankind.} $$
    </h3> -->
    <h3 style="font-family: 'Times New Roman', Times, serif; color: gray;" >
      A deep learning enthusiast, who believes in the power of AI and the ethics of humankind.
    </h3>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name"></li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/Nillau"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username" style="font-family: 'Times New Roman'"> @R2FsCg </span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p></p>
      </div>
    </div>

  </div>

</footer><script src="/scripts/common.js?t=20191126135652"></script>

  

  </body>
</html>